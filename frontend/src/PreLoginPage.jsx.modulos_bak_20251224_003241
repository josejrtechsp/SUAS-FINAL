import React, { useMemo, useState } from "react";
import "./Portal.css";

export default function PreLoginPage({ onEntrar }) {
  const [busca, setBusca] = useState("");
  const [guiaFiltro, setGuiaFiltro] = useState("");

  const chips = useMemo(
    () => ["Tipifica√ß√£o", "NOB SUAS", "Cad√önico", "RMA", "Prontu√°rio SUAS", "Vigil√¢ncia", "Pop Rua", "OSCs", "CMAS"],
    []
  );

  const guiaTopicos = useMemo(
    () => [
      { icone: "üìå", titulo: "Tipifica√ß√£o e servi√ßos", texto: "O que √© cada servi√ßo, para quem √©, e como registrar com padr√£o (sem improviso).", tags: ["Tipifica√ß√£o"] },
      { icone: "üßæ", titulo: "RMA e relat√≥rios", texto: "Como organizar registros para gerar evid√™ncia, relat√≥rios e presta√ß√£o de contas.", tags: ["RMA"] },
      { icone: "üõ°Ô∏è", titulo: "LGPD na pr√°tica (m√≠nimo necess√°rio)", texto: "Acesso por perfil, campos sens√≠veis, auditoria e boas pr√°ticas para reduzir risco institucional.", tags: ["LGPD"] },
      { icone: "üß≠", titulo: "Fluxos recomendados (por etapas)", texto: "Etapas, responsabilidades, devolutivas e valida√ß√£o: o caso n√£o ‚Äúse perde‚Äù na rede.", tags: ["Fluxo"] },
      { icone: "ü§ù", titulo: "Parcerias e OSCs", texto: "Documentos, execu√ß√£o, acompanhamento e transpar√™ncia com trilha de evid√™ncias.", tags: ["OSCs"] },
      { icone: "üèõÔ∏è", titulo: "Conselho (CMAS) e controle social", texto: "Relat√≥rios e evid√™ncias certas para delibera√ß√£o e fiscaliza√ß√£o, com rastreabilidade.", tags: ["CMAS"] },
    ],
    []
  );

  const modulos = useMemo(
    () => [
      { icone: "üè†", titulo: "CRAS", texto: "Triagem, acompanhamento familiar e encaminhamentos com padr√£o." },
      { icone: "üßæ", titulo: "CREAS", texto: "Casos complexos com etapas, prazos e contexto preservado." },
      { icone: "üö∂‚Äç‚ôÄÔ∏è", titulo: "Pop Rua", texto: "Abordagem, busca ativa e gest√£o de caso com rastreabilidade." },
      { icone: "üõèÔ∏è", titulo: "Acolhimentos", texto: "Vagas, entradas/sa√≠das, acompanhamento e relat√≥rios claros." },
      { icone: "üéØ", titulo: "Gest√£o", texto: "Painel do munic√≠pio: gargalos, produtividade e indicadores." },
      { icone: "üó∫Ô∏è", titulo: "Vigil√¢ncia", texto: "Indicadores e vis√£o territorial para prioriza√ß√£o e evid√™ncias." },
      { icone: "ü§ù", titulo: "Terceiro Setor", texto: "Parcerias/OSCs: execu√ß√£o, documentos e presta√ß√£o de contas." },
      { icone: "üèõÔ∏è", titulo: "Conselho", texto: "CMAS: evid√™ncias e relat√≥rios com trilha de auditoria." },
    ],
    []
  );

  const guiaVisivel = useMemo(() => {
    const f = guiaFiltro.trim();
    if (!f) return guiaTopicos;
    const fl = f.toLowerCase();
    return guiaTopicos.filter((t) => (t.titulo + " " + t.texto + " " + (t.tags || []).join(" ")).toLowerCase().includes(fl));
  }, [guiaFiltro, guiaTopicos]);

  function irParaAtualizacoes() {
    const q = busca.trim();
    const url = q ? `/atualizacoes?q=${encodeURIComponent(q)}` : "/atualizacoes";
    window.location.assign(url);
  }

  return (
    <div className="portal3-root">
      <header className="portal3-topbar">
        <div className="portal3-topbar-inner">
          <div className="portal3-brand">
            <div className="portal3-brand-tag">PORTAL SUAS ¬∑ Inteligencia Social</div>
            <div className="portal3-brand-title">
              Sistema <span className="portal3-brand-highlight">SUAS</span>
            </div>
            <div className="portal3-brand-sub">Atualiza√ß√µes ‚Ä¢ legisla√ß√£o ‚Ä¢ protocolos ‚Ä¢ Guia SUAS ‚Ä¢ governan√ßa de dados</div>
          </div>

          <div className="portal3-actions">
            <input
              className="portal3-search"
              value={busca}
              onChange={(e) => setBusca(e.target.value)}
              onKeyDown={(e) => e.key === "Enter" && irParaAtualizacoes()}
              placeholder="Buscar no portal (MDS, CNAS, FNAS, Tipifica√ß√£o, NOB SUAS, Cad√önico, RMA...)"
            />
            <button type="button" className="portal3-btn-secondary" onClick={irParaAtualizacoes}>
              Atualiza√ß√µes oficiais
            </button>
            <button type="button" className="portal3-btn-primary" onClick={() => onEntrar?.()}>
              Acessar o painel
            </button>
          </div>
        </div>
      </header>

      <section className="portal3-hero">
        <div className="portal3-hero-inner">
          <div>
            <div className="portal3-kicker">SUAS ‚Ä¢ CRAS ‚Ä¢ CREAS ‚Ä¢ Pop Rua ‚Ä¢ Acolhimentos ‚Ä¢ Gest√£o ‚Ä¢ Vigil√¢ncia ‚Ä¢ Terceiro Setor ‚Ä¢ Conselho ‚Ä¢ Guia SUAS</div>

            <h1 className="portal3-title">
              Organiza√ß√£o do atendimento + <span className="portal3-highlight">governan√ßa de dados</span> para servir melhor o cidad√£o e proteger o poder p√∫blico.
            </h1>

            <p className="portal3-lead">
              Um portal p√∫blico com refer√™ncias oficiais e um sistema completo para <b>padronizar registros</b>, <b>fortalecer o trabalho em rede</b> e garantir <b>acesso por perfil (LGPD)</b> ‚Äî do atendimento na ponta at√© a gest√£o, presta√ß√£o de contas e controle social.
            </p>

            <div className="portal3-cta-row">
              <button type="button" className="portal3-btn-primary portal3-btn-big" onClick={() => onEntrar?.()}>
                Entrar no sistema
              </button>
              <a className="portal3-link" href="#modulos">Conhecer os m√≥dulos ‚Üì</a>
              <a className="portal3-link" href="#guia">Guia SUAS (no portal) ‚Üì</a>
              <a className="portal3-link" href="/atualizacoes">Atualiza√ß√µes oficiais ‚Üí</a>
            </div>

            <div className="portal3-chips">
              <span className="portal3-chip">Perfis e permiss√µes (LGPD)</span>
              <span className="portal3-chip">Rastreabilidade (auditoria)</span>
              <span className="portal3-chip">Fluxo por etapas</span>
              <span className="portal3-chip">Vigil√¢ncia territorial</span>
              <span className="portal3-chip">Rede intermunicipal (cons√≥rcio)</span>
              <span className="portal3-chip">Terceiro setor e parcerias</span>
              <span className="portal3-chip">Conselho e controle social</span>
              <span className="portal3-chip">Guia SUAS</span>
            </div>
          </div>

          <div className="portal3-feature">
            <div className="portal3-feature-title">O que isso resolve no SUAS?</div>
            <ul className="portal3-bullets">
              <li>Padroniza CRAS, CREAS, Pop Rua e Acolhimentos (evita ‚Äúcada um faz do seu jeito‚Äù).</li>
              <li>Reduz retrabalho e evita perda de informa√ß√£o com hist√≥rico cont√≠nuo.</li>
              <li>Organiza encaminhamentos, devolutivas e responsabilidades por etapa.</li>
              <li>Gera indicadores e evid√™ncias para planejamento, auditoria e presta√ß√£o de contas.</li>
              <li>LGPD aplicada (m√≠nimo necess√°rio) + trilha de auditoria.</li>
            </ul>
            <button type="button" className="portal3-btn-secondary" onClick={() => onEntrar?.()}>
              Ver o painel (login)
            </button>
          </div>
        </div>
      </section>

      <main className="portal3-main">
        <section className="portal3-section" id="modulos">
          <div className="portal3-section-head">
            <h2 className="portal3-h2">M√≥dulos do Sistema SUAS</h2>
            <p className="portal3-sub">Um sistema, v√°rios m√≥dulos ‚Äî cada equipe v√™ s√≥ o que precisa.</p>
          </div>

          <div className="portal3-cards-4">
            {modulos.map((m, idx) => (
              <div key={idx} className="portal3-card">
                <div className="portal3-card-icon">{m.icone}</div>
                <div className="portal3-card-title">{m.titulo}</div>
                <div className="portal3-card-text">{m.texto}</div>
              </div>
            ))}
          </div>

          <div className="portal3-cta-strip">
            <div className="portal3-cta-strip-text">Para legisla√ß√£o e atos recentes, use a p√°gina de Atualiza√ß√µes Oficiais (filtros Federal/SP + busca).</div>
            <button type="button" className="portal3-btn-primary" onClick={irParaAtualizacoes}>Abrir Atualiza√ß√µes</button>
          </div>
        </section>

        <section className="portal3-section" id="guia">
          <div className="portal3-section-head portal3-section-head-row">
            <div>
              <h2 className="portal3-h2">Guia SUAS (dentro do portal)</h2>
              <p className="portal3-sub">Normas, rotinas e modelos prontos em linguagem simples.</p>
            </div>
            <div className="portal3-filter">
              <button type="button" className="portal3-pill" onClick={() => setGuiaFiltro("")}>Todos</button>
              <button type="button" className="portal3-pill" onClick={() => setGuiaFiltro("Tipifica√ß√£o")}>Tipifica√ß√£o</button>
              <button type="button" className="portal3-pill" onClick={() => setGuiaFiltro("RMA")}>RMA</button>
              <button type="button" className="portal3-pill" onClick={() => setGuiaFiltro("LGPD")}>LGPD</button>
            </div>
          </div>

          <div className="portal3-chips">
            {chips.map((c) => (
              <button key={c} type="button" className="portal3-chip portal3-chip-btn" onClick={() => setGuiaFiltro(c)}>
                {c}
              </button>
            ))}
          </div>

          <div className="portal3-cards-4" style={{ marginTop: 12 }}>
            {guiaVisivel.map((g, idx) => (
              <div key={idx} className="portal3-card">
                <div className="portal3-card-icon">{g.icone}</div>
                <div className="portal3-card-title">{g.titulo}</div>
                <div className="portal3-card-text">{g.texto}</div>
              </div>
            ))}
          </div>

          <div className="portal3-cta-strip">
            <div className="portal3-cta-strip-text">Quer ver normas/atos recentes? Abra Atualiza√ß√µes Oficiais.</div>
            <button type="button" className="portal3-btn-primary" onClick={irParaAtualizacoes}>Ir para Atualiza√ß√µes</button>
          </div>
        </section>

        <footer className="portal3-footer">
          <div className="portal3-footer-inner">
            <span><strong>Portal SUAS</strong> ‚Ä¢ Inteligencia Social</span>
            <span className="portal3-footer-muted">Home limpa + Atualiza√ß√µes em /atualizacoes</span>
          </div>
        </footer>
      </main>
    </div>
  );
}
