import React, { useEffect, useMemo, useState } from "react";

/* ---------- helpers ---------- */
function useWindowWidth() {
  const [w, setW] = useState(() => (typeof window === "undefined" ? 1200 : window.innerWidth));
  useEffect(() => {
    const on = () => setW(window.innerWidth);
    window.addEventListener("resize", on);
    return () => window.removeEventListener("resize", on);
  }, []);
  return w;
}

function useAreaParam(defaultKey = "suas") {
  const read = () => {
    try {
      const u = new URL(window.location.href);
      return u.searchParams.get("area") || defaultKey;
    } catch {
      return defaultKey;
    }
  };
  const [area, setArea] = useState(read);

  useEffect(() => {
    const onPop = () => setArea(read());
    window.addEventListener("popstate", onPop);
    return () => window.removeEventListener("popstate", onPop);
  }, []);

  const go = (next) => {
    const u = new URL(window.location.href);
    u.searchParams.set("area", next);
    window.history.pushState({}, "", u.toString());
    setArea(next);
    
  };

  return { area, go };
}

function Pill({ children }) {
  return (
    <span
      style={{
        display: "inline-flex",
        alignItems: "center",
        gap: 8,
        padding: "6px 10px",
        borderRadius: 999,
        border: "1px solid rgba(122,92,255,0.18)",
        background: "rgba(122,92,255,0.10)",
        color: "rgba(90,70,210,1)",
        fontWeight: 900,
        fontSize: 12,
        letterSpacing: 0.4,
        textTransform: "uppercase",
      }}
    >
      {children}
    </span>
  );
}

function CardBox({ title, icon, children }) {
  return (
    <div
      style={{
        border: "1px solid rgba(0,0,0,0.06)",
        background: "rgba(255,255,255,0.70)",
        borderRadius: 18,
        padding: 14,
      }}
    >
      <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 10 }}>
        <span style={{ fontSize: 16 }}>{icon}</span>
        <div style={{ fontWeight: 980 }}>{title}</div>
      </div>
      <div style={{ fontSize: 14, color: "rgba(15,23,42,0.92)" }}>{children}</div>
    </div>
  );
}

function ItemList({ items, bullet = "‚úÖ" }) {
  return (
    <div style={{ display: "grid", gap: 8 }}>
      {items.map((t, idx) => (
        <div key={idx} style={{ display: "flex", gap: 10, alignItems: "flex-start" }}>
          <div style={{ lineHeight: "18px" }}>{bullet}</div>
          <div style={{ lineHeight: "18px" }}>{t}</div>
        </div>
      ))}
    </div>
  );
}

function Step({ n, title, desc }) {
  return (
    <div
      style={{
        border: "1px solid rgba(0,0,0,0.06)",
        background: "rgba(255,255,255,0.70)",
        borderRadius: 18,
        padding: 14,
        display: "flex",
        gap: 12,
        alignItems: "flex-start",
      }}
    >
      <div
        style={{
          width: 28,
          height: 28,
          borderRadius: 999,
          display: "grid",
          placeItems: "center",
          fontWeight: 980,
          color: "rgba(90,70,210,1)",
          border: "1px solid rgba(122,92,255,0.22)",
          background: "rgba(122,92,255,0.10)",
          flex: "0 0 auto",
        }}
      >
        {n}
      </div>
      <div>
        <div style={{ fontWeight: 980 }}>{title}</div>
        <div style={{ marginTop: 4, fontSize: 13, opacity: 0.85 }}>{desc}</div>
      </div>
    </div>
  );
}

function Button({ kind = "primary", children, onClick }) {
  const base = {
    borderRadius: 999,
    padding: "10px 14px",
    fontWeight: 900,
    fontSize: 14,
    border: "1px solid rgba(0,0,0,0.08)",
    background: "rgba(255,255,255,0.75)",
    cursor: "pointer",
    boxShadow: "0 10px 24px rgba(0,0,0,0.08)",
  };
  const primary = {
    border: "1px solid rgba(122,92,255,0.25)",
    background: "rgba(122,92,255,0.95)",
    color: "white",
  };
  return (
    <button type="button" onClick={onClick} style={{ ...base, ...(kind === "primary" ? primary : {}) }}>
      {children}
    </button>
  );
}

/* ---------- component ---------- */
export default function IdealAreas() {
  const { area, go } = useAreaParam("suas");
  const w = useWindowWidth();
  const mobile = w < 980;

  const defs = useMemo(
    () => ({
      suas: {
        key: "suas",
        icon: "ü§ù",
        menuTitle: "SUAS",
        menuDesc: "Fluxo, SLA, evid√™ncias e rede (CRAS/CREAS/PopRua).",
        pill: "SUAS",
        title: "Assist√™ncia Social (SUAS)",
        tagline:
          "Do atendimento ao relat√≥rio: padroniza a rotina, cria continuidade e d√° visibilidade de prazos, etapas e resultados.",
        why: [
          "Processo sai do ‚Äúinvis√≠vel‚Äù: etapas, prazos e respons√°veis ficam claros.",
          "Caso parado vira pend√™ncia com prazo e pr√≥xima a√ß√£o obrigat√≥ria.",
          "Rede organizada com devolutiva e evid√™ncias (sem perder hist√≥rico).",
        ],
        delivers: [
          "Prontu√°rio simples + linha do tempo",
          "Pend√™ncias/SLA + justificativa de estagna√ß√£o",
          "Encaminhamentos com retorno e alertas",
          "Relat√≥rios (produ√ß√£o, gargalos, rede, demanda)",
        ],
        indicators: [
          "SLA cumprido vs vencido por etapa",
          "Casos ativos/novos/encerrados por per√≠odo",
          "Tempo m√©dio por etapa e por t√©cnico",
          "Demandas por tema/detalhe e territ√≥rio",
        ],
        steps: [
          { title: "Desenhar o fluxo", desc: "Etapas, SLA e respons√°veis por unidade/servi√ßo." },
          { title: "Executar e registrar", desc: "Registro padronizado com evid√™ncias anexadas." },
          { title: "Monitorar e cobrar", desc: "Pend√™ncias, alertas e indicadores para decis√£o." },
        ],
        take: [
          "Templates de fluxos e relat√≥rios por servi√ßo",
          "Governan√ßa por perfil (LGPD) e auditoria",
          "Integra√ß√£o intersetorial (rede) quando necess√°rio",
          "Configura√ß√£o por unidade e equipe",
        ],
      },

      saude: {
        key: "saude",
        icon: "ü©∫",
        menuTitle: "Sa√∫de",
        menuDesc: "Processos por etapa, evid√™ncias e indicadores para reduzir fila e gargalos.",
        pill: "Sa√∫de",
        title: "Sa√∫de (gest√£o e execu√ß√£o)",
        tagline:
          "Processos por etapa, evid√™ncias e indicadores para reduzir fila, corrigir gargalos e entregar resultado com rastreabilidade.",
        why: [
          "Fila sob controle: tempo por etapa/servi√ßo com gargalos vis√≠veis.",
          "Processo audit√°vel: registro padronizado + evid√™ncias anexadas.",
          "SLA e pend√™ncias: atraso vira alerta + justificativa + pr√≥xima a√ß√£o.",
        ],
        delivers: [
          "Trilhas por processo (SLA) com respons√°veis",
          "Pend√™ncias autom√°ticas + justificativa de estagna√ß√£o",
          "Dashboards (fila, produ√ß√£o, tempo, gargalos)",
          "Relat√≥rios para gest√£o e presta√ß√£o de contas",
        ],
        indicators: [
          "Tempo de espera por etapa/servi√ßo",
          "Backlog e taxa de resolu√ß√£o",
          "Produ√ß√£o por unidade/equipe",
          "Gargalos por etapa e motivo",
        ],
        steps: [
          { title: "Mapear o processo", desc: "Fila, etapas, respons√°veis e pontos de estrangulamento." },
          { title: "Operar com evid√™ncia", desc: "Registro padronizado e anexos para auditoria." },
          { title: "Gerir por indicador", desc: "Painel do gestor para priorizar e redistribuir." },
        ],
        take: [
          "Fluxos por servi√ßo prontos (SLA)",
          "Pain√©is acion√°veis para decis√£o r√°pida",
          "Auditoria e trilha completa",
          "Relat√≥rios por unidade e equipe",
        ],
      },

      educacao: {
        key: "educacao",
        icon: "üéì",
        menuTitle: "Educa√ß√£o",
        menuDesc: "Fluxos, registros e indicadores para presen√ßa, evas√£o e execu√ß√£o com evid√™ncias.",
        pill: "Educa√ß√£o",
        title: "Educa√ß√£o (gest√£o e execu√ß√£o)",
        tagline: "Presen√ßa, evas√£o, transporte e execu√ß√£o com registros e indicadores ‚Äî com evid√™ncias.",
        why: [
          "Alerta de risco: faltas e sinais de evas√£o viram fluxo de a√ß√£o.",
          "Execu√ß√£o rastre√°vel: manuten√ß√£o, transporte e demandas com prazo.",
          "Gest√£o por escola/turma/bairro com indicadores acion√°veis.",
        ],
        delivers: [
          "Fluxos de busca ativa e acompanhamento",
          "Registro e anexos (documentos/ocorr√™ncias)",
          "Pend√™ncias/SLA por escola e equipe",
          "Relat√≥rios e indicadores por territ√≥rio",
        ],
        indicators: [
          "Frequ√™ncia por escola/turma",
          "Alertas de risco e acompanhamento",
          "Demandas de transporte e rotas",
          "Chamados e tempo de resolu√ß√£o",
        ],
        steps: [
          { title: "Definir rotinas", desc: "Busca ativa, manuten√ß√£o, transporte e prazos." },
          { title: "Registrar e acompanhar", desc: "A√ß√µes com evid√™ncia e respons√°veis claros." },
          { title: "Cobrar resultado", desc: "Indicadores por escola e territ√≥rio." },
        ],
        take: [
          "Rotinas padronizadas por processo",
          "Pain√©is por escola/turma/bairro",
          "Trilha de evid√™ncias e auditoria",
          "Relat√≥rios prontos para gest√£o",
        ],
      },

      pesquisas: {
        key: "pesquisas",
        icon: "üìä",
        menuTitle: "Pesquisas",
        menuDesc: "Eleitoral, mercado e qualidade do servi√ßo p√∫blico ‚Äî m√©todo + execu√ß√£o + recomenda√ß√£o.",
        pill: "Pesquisas",
        title: "Pesquisas (p√∫blica e de mercado)",
        tagline: "Eleitoral, mercado e pol√≠ticas p√∫blicas ‚Äî diagn√≥stico, m√©todo, execu√ß√£o e recomenda√ß√£o.",
        why: [
          "Diagn√≥stico r√°pido com m√©todo e recorte territorial.",
          "Leitura acion√°vel: prioridades e plano de a√ß√£o.",
          "Acompanhamento recorrente (tracking) para corrigir rota.",
        ],
        delivers: [
          "Question√°rio + plano amostral + campo",
          "Relat√≥rios executivos e t√©cnicos",
          "Dashboards e recortes por territ√≥rio",
          "Recomenda√ß√µes e plano de execu√ß√£o",
        ],
        indicators: [
          "Satisfa√ß√£o e percep√ß√£o por bairro",
          "Atributos (sa√∫de/educa√ß√£o/infra/assist√™ncia)",
          "Tend√™ncias e varia√ß√µes (tracking)",
          "Mapa de problemas e prioridades",
        ],
        steps: [
          { title: "Desenhar pesquisa", desc: "Objetivo, recortes, amostra e instrumentos." },
          { title: "Executar campo", desc: "Coleta, limpeza e consist√™ncia dos dados." },
          { title: "Entregar plano", desc: "Relat√≥rio + recomenda√ß√µes e metas." },
        ],
        take: [
          "Diagn√≥stico com mapa e prioridades",
          "Relat√≥rios prontos para decis√£o",
          "Dashboard com recortes",
          "Plano de a√ß√£o orientado por evid√™ncia",
        ],
      },

      projetos: {
        key: "projetos",
        icon: "üíº",
        menuTitle: "Projetos",
        menuDesc: "Gest√£o de projetos p√∫blicos: planejamento ‚Üí execu√ß√£o ‚Üí monitoramento ‚Üí entrega.",
        pill: "Projetos",
        title: "Projetos (gest√£o e entrega)",
        tagline: "Do plano √† entrega: gest√£o por fluxo, prazos, respons√°veis e evid√™ncias.",
        why: [
          "Cada entrega com dono, prazo e evid√™ncia.",
          "Gargalos vis√≠veis (SLA) e cobran√ßa autom√°tica.",
          "Transpar√™ncia: trilha audit√°vel do que foi feito.",
        ],
        delivers: [
          "Plano de execu√ß√£o por etapa",
          "Pend√™ncias e alertas (SLA)",
          "Relat√≥rios de status e riscos",
          "Dashboard de entregas por √°rea",
        ],
        indicators: [
          "Entregas no prazo vs vencidas",
          "Backlog e capacidade da equipe",
          "Tempo m√©dio por etapa",
          "Riscos e bloqueios recorrentes",
        ],
        steps: [
          { title: "Definir escopo", desc: "Entreg√°veis, respons√°veis e prazos." },
          { title: "Executar em fluxo", desc: "Etapas padronizadas e evid√™ncias." },
          { title: "Monitorar e fechar", desc: "Relat√≥rios e cobran√ßa por SLA." },
        ],
        take: [
          "Modelo de governan√ßa por projeto",
          "Dashboards de acompanhamento",
          "Trilha de auditoria",
          "Relat√≥rios executivos",
        ],
      },
ouvidoria: {
        key: "ouvidoria",
        icon: "üì£",
        menuTitle: "Ouvidoria",
        menuDesc: "Mapa em tempo real + SLA + backlog por bairro/tema (asfalto, ilumina√ß√£o, energia, rem√©dios etc.).",
        pill: "Ouvidoria",
        title: "Ouvidoria (gest√£o de demandas)",
        tagline:
          "Ouvidoria digital com triagem, SLA e mapa em tempo real: cada demanda vira tarefa com prazo, respons√°vel e devolutiva ao cidad√£o.",
        why: [
          "Tempo de resposta cai porque toda demanda entra em fluxo com SLA, respons√°vel e alertas de atraso.",
          "Mapa/heatmap em tempo real mostra onde est√£o os problemas (por bairro/rua) e ajuda a priorizar.",
          "Categorias padronizadas (asfalto, ilumina√ß√£o, lixo, energia, √°gua, rem√©dios, transporte etc.) viram relat√≥rio e decis√£o.",
        ],
        delivers: [
          "Canais: portal/app/WhatsApp + protocolo + anexos (foto/arquivo) + localiza√ß√£o",
          "Triagem por tema e secretaria + fila por respons√°vel (sem perder demanda no WhatsApp)",
          "SLA, pend√™ncias e justificativa de atraso + pr√≥xima a√ß√£o obrigat√≥ria",
          "Pain√©is: ranking por bairro, tipos de demanda, reincid√™ncia e tempo m√©dio de resposta",
        ],
        indicators: [
          "Tempo m√©dio de 1¬™ resposta e tempo m√©dio de resolu√ß√£o",
          "% dentro do SLA vs vencido (por tema e por secretaria)",
          "Backlog por categoria (asfalto, ilumina√ß√£o, sa√∫de, rem√©dios etc.) e por bairro/rua",
          "Reincid√™ncia por local/problema e taxa de resolu√ß√£o",
        ],
        steps: [
          { title: "Configurar categorias e SLAs", desc: "Temas, secretarias respons√°veis, prazos e regras de triagem." },
          { title: "Operar a fila com devolutiva", desc: "Protocolo, respons√°vel, anexos, andamento e retorno ao cidad√£o." },
          { title: "Gerir por mapa e indicadores", desc: "Hotspots, prioridades, cobran√ßa e relat√≥rios para gabinete e secretarias." },
        ],
        take: [
          "Canal √∫nico com protocolo e hist√≥rico por endere√ßo/cidad√£o",
          "Gest√£o por SLA (cobran√ßa autom√°tica) + transpar√™ncia do andamento",
          "Mapa em tempo real + ranking por bairro e categoria",
          "Relat√≥rios prontos para tomada de decis√£o e presta√ß√£o de contas",
        ],
      },
    }),
    []
  );

  const order = ["suas", "saude", "educacao", "pesquisas", "projetos", "ouvidoria"];
  const current = defs[area] || defs.suas;

  const outer = {
    borderRadius: 28,
    border: "1px solid rgba(0,0,0,0.06)",
    background:
      "linear-gradient(180deg, rgba(255,255,255,0.75), rgba(255,255,255,0.60))",
    boxShadow: "0 20px 55px rgba(0,0,0,0.10)",
    padding: mobile ? 18 : 24,
  };

  const headerRow = {
    display: "flex",
    flexDirection: mobile ? "column" : "row",
    justifyContent: "space-between",
    alignItems: mobile ? "flex-start" : "flex-start",
    gap: 14,
    marginBottom: 16,
  };

  const layout = {
    display: "grid",
    gridTemplateColumns: mobile ? "1fr" : "320px 1fr",
    gap: 16,
    alignItems: "start",
  };

  const menuCard = (active) => ({
    width: "100%",
    textAlign: "left",
    borderRadius: 18,
    border: "1px solid rgba(0,0,0,0.06)",
    background: active ? "rgba(122,92,255,0.10)" : "rgba(255,255,255,0.65)",
    padding: 14,
    cursor: "pointer",
  });

  return (
    <section style={{ padding: mobile ? 14 : 22 }}>
      <div style={outer}>
        <div style={headerRow}>
          <div>
            <Pill>IDEAL ¬∑ √ÅREAS</Pill>
            <div style={{ fontSize: mobile ? 30 : 44, fontWeight: 990, lineHeight: 1.05, marginTop: 10, letterSpacing: -0.8,
  background: "linear-gradient(90deg, #A855F7 0%, #6366F1 55%, #22D3EE 100%)",
  WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent", color: "transparent" }}>
              IDEAL ‚Äî Intelig√™ncia P√∫blica e de Mercado
            </div>
            <div style={{ marginTop: 10, fontSize: 16, opacity: 0.85, maxWidth: 880 }}>
              Solu√ß√µes integradas para prefeituras: SUAS, Sa√∫de, Educa√ß√£o, Pesquisas, Projetos e Ouvidoria ‚Äî com fluxo, SLA, evid√™ncias e indicadores para acelerar resultados.
            </div>
          </div>

          <div style={{ display: "flex", gap: 10, flexWrap: "wrap" }}>
            <Button kind="primary" onClick={() => window.scrollTo({ top: 0, behavior: "smooth" })}>
              Ver solu√ß√µes
            </Button>
            <Button onClick={() => (window.location.href = "/login")}>Entrar (login)</Button>
            <Button onClick={() => (window.location.href = "#contato")}>Agendar demo</Button>
          </div>
        </div>

        <div style={layout}>
          {/* LEFT MENU */}
          <div style={{ display: "grid", gap: 12 }}>
            {order.map((k) => {
              const a = defs[k];
              const active = current.key === a.key;
              return (
                <button key={a.key} type="button" onClick={() => go(a.key)} style={menuCard(active)}>
                  <div style={{ display: "flex", gap: 12, alignItems: "center" }}>
                    <div
                      style={{
                        width: 34,
                        height: 34,
                        borderRadius: 999,
                        border: "1px solid rgba(122,92,255,0.20)",
                        background: "rgba(122,92,255,0.08)",
                        display: "grid",
                        placeItems: "center",
                        fontSize: 16,
                        flex: "0 0 auto",
                      }}
                    >
                      {a.icon}
                    </div>
                    <div>
                      <div style={{ display: "flex", gap: 8, alignItems: "baseline" }}>
                        <div style={{ fontWeight: 980, fontSize: 16 }}>{a.menuTitle}</div>
                        <div style={{ fontSize: 12, opacity: 0.6, fontWeight: 900, textTransform: "uppercase" }}>
                          {a.pill}
                        </div>
                      </div>
                      <div style={{ marginTop: 3, fontSize: 13, opacity: 0.85 }}>{a.menuDesc}</div>
                    </div>
                  </div>
                </button>
              );
            })}
          </div>

          {/* RIGHT CONTENT */}
          <div>
            <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 6 }}>
              <Pill>{current.pill}</Pill>
              <div style={{ fontSize: mobile ? 26 : 34, fontWeight: 980, letterSpacing: -0.6 }}>{current.title}</div>
            </div>
            <div style={{ fontSize: 15, opacity: 0.9, marginBottom: 14 }}>{current.tagline}</div>

            {/* top 3 cards */}
            <div
              style={{
                display: "grid",
                gridTemplateColumns: mobile ? "1fr" : "1fr 1fr 1fr",
                gap: 12,
              }}
            >
              <CardBox title="Por que funciona" icon="‚úÖ">
                <ItemList items={current.why} bullet="‚úÖ" />
              </CardBox>

              <CardBox title="O que entregamos" icon="üì¶">
                <ItemList items={current.delivers} bullet="üì¶" />
              </CardBox>

              <CardBox title="Indicadores" icon="üìä">
                <ItemList items={current.indicators} bullet="üìä" />
              </CardBox>
            </div>

            {/* bottom row */}
            <div
              style={{
                display: "grid",
                gridTemplateColumns: mobile ? "1fr" : "1.15fr 0.85fr",
                gap: 12,
                marginTop: 12,
              }}
            >
              <div
                style={{
                  border: "1px solid rgba(0,0,0,0.06)",
                  background: "rgba(255,255,255,0.70)",
                  borderRadius: 18,
                  padding: 14,
                }}
              >
                <div style={{ fontWeight: 980, marginBottom: 10 }}>Como colocamos de p√©</div>
                <div style={{ display: "grid", gap: 10 }}>
                  {current.steps.map((st, idx) => (
                    <Step key={idx} n={idx + 1} title={st.title} desc={st.desc} />
                  ))}
                </div>
              </div>

              <div
                style={{
                  border: "1px solid rgba(0,0,0,0.06)",
                  background: "rgba(255,255,255,0.70)",
                  borderRadius: 18,
                  padding: 14,
                }}
              >
                <div style={{ fontWeight: 980, marginBottom: 10 }}>O que voc√™ leva para casa</div>
                <ItemList items={current.take} bullet="‚úÖ" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  );
}
