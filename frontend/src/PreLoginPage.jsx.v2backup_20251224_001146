import React, { useMemo, useState } from "react";
import "./Portal.css";

export default function PreLoginPage({ onEntrar }) {
  const [busca, setBusca] = useState("");
  const [filtro, setFiltro] = useState("federal"); // federal | sp

  const updatesFederal = useMemo(
    () => [
      {
        tag: "CNAS/MDS",
        titulo:
          "Resolu√ß√£o CNAS/MDS n¬∫ 220 (25/11/2025) ‚Äî Diretrizes do Prontu√°rio Eletr√¥nico do SUAS",
        resumo:
          "Diretrizes para prontu√°rio eletr√¥nico no SUAS (base para padroniza√ß√£o e qualidade do registro).",
        data: "26/11/2025",
        url: "https://blog.mds.gov.br/redesuas/resolucao-cnas-mds-no-220-de-25-de-novembro-de-2025/",
      },
      {
        tag: "MDS",
        titulo: "Portaria MDS n¬∫ 1.136 (04/12/2025)",
        resumo:
          "Ato normativo recente do MDS. Utilize como refer√™ncia de atualiza√ß√£o regulat√≥ria no SUAS.",
        data: "05/12/2025",
        url: "https://www.gov.br/mds/pt-br/acesso-a-informacao/legislacao/portaria/portaria-mds-no-1-136-de-4-de-dezembro-de-2025",
      },
      {
        tag: "FNAS",
        titulo: "FNAS ‚Äî prazos/crit√©rio do Selo FNAS e verifica√ß√µes do AgilizaSUAS",
        resumo:
          "Atualiza√ß√£o de prazos e crit√©rios: verifica√ß√£o e concess√£o do Selo em 2026, exig√™ncias e execu√ß√£o m√≠nima.",
        data: "2025/2026",
        url: "https://fnas.mds.gov.br/fnas-divulga-novos-prazos-para-apuracao-e-concessao-do-selo-fnas/",
      },
      {
        tag: "SNAS/MDS",
        titulo:
          "Portaria SNAS/MDS n¬∫ 47 (25/04/2025) ‚Äî itens financi√°veis com recursos SUAS (fundo a fundo)",
        resumo:
          "Lista padronizada de ve√≠culos/equipamentos/materiais permanentes aptos √† aquisi√ß√£o com recursos do SUAS.",
        data: "29/04/2025",
        url: "https://fnas.mds.gov.br/nova-portaria-atualiza-lista-de-itens-que-podem-ser-adquiridos-com-recursos-do-suas/",
      },
      {
        tag: "MDS/INSS",
        titulo:
          "Portaria Conjunta MDS/INSS n¬∫ 34 (09/10/2025) ‚Äî regras do BPC",
        resumo:
          "Regras e procedimentos para requerimento, concess√£o, manuten√ß√£o e revis√£o do BPC.",
        data: "10/10/2025",
        url: "https://www.gov.br/inss/pt-br/centrais-de-conteudo/legislacao/portarias-conjuntas/2025/ptcj34mds-inss.pdf",
      },
    ],
    []
  );

  const updatesSP = useMemo(
    () => [
      {
        tag: "CIB/SP",
        titulo:
          "Portaria CIB/SP n¬∫ 07 (25/07/2025) ‚Äî Vigil√¢ncia Socioassistencial (prazo de Plano de A√ß√£o)",
        resumo:
          "Pactua√ß√£o estadual (SP) prorrogando prazo para apresenta√ß√£o do Plano de A√ß√£o da Vigil√¢ncia Socioassistencial.",
        data: "07/2025",
        url: "https://www.desenvolvimentosocial.sp.gov.br/wp-content/uploads/2025/08/port--07-julho-2025.pdf",
      },
      {
        tag: "DOE/SP",
        titulo:
          "Portaria (29/05/2025) ‚Äî suplementa√ß√£o FEAS (Fundo Estadual de Assist√™ncia Social)",
        resumo:
          "Exemplo de norma estadual sobre cofinanciamento/gest√£o do FEAS e pactua√ß√£o de recursos.",
        data: "30/05/2025",
        url: "https://www.doe.sp.gov.br/executivo/secretaria-de-desenvolvimento-social/portaria-de-29-de-maio-de-2025-20250529112012141112375",
      },
    ],
    []
  );

  const atualizacoes = useMemo(() => {
    const base = filtro === "sp" ? updatesSP : updatesFederal;
    const q = busca.trim().toLowerCase();
    if (!q) return base;
    return base.filter((u) =>
      (u.titulo + " " + u.resumo + " " + u.tag).toLowerCase().includes(q)
    );
  }, [busca, filtro, updatesFederal, updatesSP]);

  const modulos = useMemo(
    () => [
      {
        icone: "üè†",
        titulo: "CRAS (PAIF / SCFV / encaminhamentos)",
        texto:
          "Padroniza triagem, acompanhamento familiar e encaminhamentos. Formul√°rios guiados e hist√≥rico para reduzir retrabalho e melhorar continuidade.",
      },
      {
        icone: "üßæ",
        titulo: "CREAS (PAEFI / viola√ß√µes / medidas)",
        texto:
          "Organiza casos com maior complexidade com etapas, prazos e registro estruturado para evitar perda de contexto e garantir continuidade.",
      },
      {
        icone: "üö∂‚Äç‚ôÄÔ∏è",
        titulo: "Pop Rua (abordagem e gest√£o de caso)",
        texto:
          "Atendimento orientado por protocolo, registro r√°pido em campo, hist√≥rico recuper√°vel e acompanhamento por etapas com devolutivas na rede.",
      },
      {
        icone: "üõèÔ∏è",
        titulo: "Acolhimentos (unidades, vagas e movimenta√ß√µes)",
        texto:
          "Controle de acolhimentos, vagas, entradas/sa√≠das e acompanhamento, com relat√≥rios claros para gest√£o e rede de encaminhamento.",
      },
      {
        icone: "üéØ",
        titulo: "Gest√£o e Coordena√ß√£o (painel do munic√≠pio)",
        texto:
          "Vis√£o em tempo real da rede: gargalos, produtividade, tempos por etapa, filas e indicadores por unidade, territ√≥rio e p√∫blico atendido.",
      },
      {
        icone: "üó∫Ô∏è",
        titulo: "Vigil√¢ncia Socioassistencial (territ√≥rio e evid√™ncias)",
        texto:
          "Indicadores e vis√£o territorial para identificar concentra√ß√µes de demanda, vazios assistenciais e prioridades de aloca√ß√£o de recursos.",
      },
      {
        icone: "ü§ù",
        titulo: "Terceiro Setor (parcerias e presta√ß√£o de contas)",
        texto:
          "√Årea para OSCs registrarem execu√ß√£o, documentos e presta√ß√£o de contas, com organiza√ß√£o e transpar√™ncia para acompanhamento.",
      },
      {
        icone: "üèõÔ∏è",
        titulo: "Conselho (CMAS e controle social)",
        texto:
          "Acesso estruturado √† informa√ß√£o certa: relat√≥rios, metas, evid√™ncias e trilhas de auditoria para fortalecer fiscaliza√ß√£o e delibera√ß√£o.",
      },
      {
        icone: "üìö",
        titulo: "Guia SUAS (normas, rotinas e modelos prontos)",
        texto:
          "Biblioteca pr√°tica dentro do portal: refer√™ncias oficiais em linguagem simples, checklists e modelos por servi√ßo ‚Äî menos improviso na ponta.",
      },
    ],
    []
  );

  const motivosLicenca = useMemo(
    () => [
      {
        titulo: "Menos retrabalho e mais continuidade",
        texto:
          "Quando o registro √© padronizado e o hist√≥rico √© recuper√°vel, a rede reduz repeti√ß√£o, melhora o fluxo e evita perda de informa√ß√£o.",
        icone: "üß©",
      },
      {
        titulo: "LGPD aplicada (m√≠nimo necess√°rio)",
        texto:
          "Perfis diferentes acessam n√≠veis diferentes de informa√ß√£o. Isso protege dados sens√≠veis e reduz risco institucional.",
        icone: "üõ°Ô∏è",
      },
      {
        titulo: "Evid√™ncias para gest√£o e presta√ß√£o de contas",
        texto:
          "Rastreabilidade (quem fez/quando/por qu√™) ajuda auditoria, relat√≥rios, indicadores e decis√µes de pol√≠tica p√∫blica.",
        icone: "üìä",
      },
      {
        titulo: "Rede entre munic√≠pios (cons√≥rcio)",
        texto:
          "Coordena√ß√£o regional com vis√£o agregada e comparativos, apoiando pactua√ß√µes, fluxos e retornos entre munic√≠pios.",
        icone: "ü§ù",
      },
      {
        titulo: "Fluxo por etapas (alertas e prazos)",
        texto:
          "Cada caso avan√ßa por etapas claras, com valida√ß√£o, prazos e alertas de estagna√ß√£o ‚Äî a gest√£o enxerga onde est√° travando.",
        icone: "‚è±Ô∏è",
      },
      {
        titulo: "Transpar√™ncia para OSC e Conselho",
        texto:
          "Organiza parcerias, documentos e acompanhamento com vis√£o segura e objetiva para controle social e presta√ß√£o de contas.",
        icone: "üîé",
      },
    ],
    []
  );

  const perfis = useMemo(
    () => [
      {
        icone: "üßë‚Äçüíª",
        titulo: "T√©cnicos",
        texto:
          "Registro r√°pido, formul√°rios guiados, hist√≥rico do caso/fam√≠lia, encaminhamentos e devolutivas.",
      },
      {
        icone: "üß≠",
        titulo: "Coordena√ß√£o/Gest√£o",
        texto:
          "Painel do munic√≠pio, gargalos, produtividade e indicadores por unidade/territ√≥rio.",
      },
      {
        icone: "üóìÔ∏è",
        titulo: "Administrativo",
        texto:
          "Organiza√ß√£o de rotinas, agenda, eventos e suporte operacional √† rede.",
      },
      {
        icone: "üí∞",
        titulo: "Financeiro/Presta√ß√£o de contas",
        texto:
          "Relat√≥rios e evid√™ncias para transpar√™ncia, auditoria e controle.",
      },
      {
        icone: "üè¢",
        titulo: "Terceiro setor (OSCs)",
        texto:
          "Registros e presta√ß√£o de contas organizada, com trilhas e documentos por parceria.",
      },
      {
        icone: "üèõÔ∏è",
        titulo: "Conselho (CMAS)",
        texto:
          "Acesso orientado a evid√™ncias e relat√≥rios com rastreabilidade, fortalecendo o controle social.",
      },
    ],
    []
  );

  const guiaTopicos = useMemo(
    () => [
      { icone: "üìå", titulo: "Tipifica√ß√£o e servi√ßos", texto: "O que √© cada servi√ßo, para quem √© e como registrar sem improviso." },
      { icone: "üßæ", titulo: "RMA e relat√≥rios", texto: "Como organizar registro para gerar evid√™ncia e presta√ß√£o de contas." },
      { icone: "üõ°Ô∏è", titulo: "LGPD na pr√°tica", texto: "Acesso por perfil, m√≠nimo necess√°rio, auditoria e boas pr√°ticas." },
      { icone: "üß≠", titulo: "Fluxos recomendados", texto: "Etapas, responsabilidades, devolutivas e valida√ß√µes na rede." },
      { icone: "ü§ù", titulo: "Parcerias e OSC", texto: "Documentos, execu√ß√£o, acompanhamento e transpar√™ncia." },
      { icone: "üèõÔ∏è", titulo: "Conselho e controle social", texto: "Relat√≥rios e evid√™ncias certas para delibera√ß√£o e fiscaliza√ß√£o." },
    ],
    []
  );

  const guiaFiltrado = useMemo(() => {
    const q = busca.trim().toLowerCase();
    if (!q) return guiaTopicos;
    return guiaTopicos.filter((t) =>
      (t.titulo + " " + t.texto).toLowerCase().includes(q)
    );
  }, [busca, guiaTopicos]);

  function irParaLogin() {
    onEntrar?.();
  }

  return (
    <div className="portal3-root">
      <header className="portal3-topbar">
        <div className="portal3-topbar-inner">
          <div className="portal3-brand">
            <div className="portal3-brand-tag">PORTAL SUAS</div>
            <div className="portal3-brand-title">
              Sistema <span className="portal3-brand-highlight">SUAS</span>
            </div>
            <div className="portal3-brand-sub">
              Atualiza√ß√µes ‚Ä¢ legisla√ß√£o ‚Ä¢ protocolos ‚Ä¢ Guia SUAS ‚Ä¢ governan√ßa de dados ‚Ä¢ Inteligencia Social
            </div>
          </div>

          <div className="portal3-actions">
            <input
              className="portal3-search"
              value={busca}
              onChange={(e) => setBusca(e.target.value)}
              placeholder="Buscar no portal (MDS, CNAS, FNAS, Tipifica√ß√£o, NOB SUAS, Cad√önico, RMA, Prontu√°rio SUAS...)"
            />
            <button
              type="button"
              className="portal3-btn-primary"
              onClick={irParaLogin}
            >
              Acessar o painel
            </button>
          </div>
        </div>
      </header>

      <section className="portal3-hero">
        <div className="portal3-hero-inner">
          <div>
            <div className="portal3-kicker">
              SUAS ‚Ä¢ CRAS ‚Ä¢ CREAS ‚Ä¢ Pop Rua ‚Ä¢ Acolhimentos ‚Ä¢ Gest√£o ‚Ä¢ Vigil√¢ncia ‚Ä¢ Terceiro Setor ‚Ä¢ Conselho ‚Ä¢ Guia SUAS
            </div>

            <h1 className="portal3-title">
              Organiza√ß√£o do atendimento +{" "}
              <span className="portal3-highlight">governan√ßa de dados</span> para
              servir melhor o cidad√£o e proteger o poder p√∫blico.
            </h1>

            <p className="portal3-lead">
              Um portal p√∫blico com refer√™ncias oficiais e um sistema completo para <b>padronizar registros</b>, <b>fortalecer o trabalho em rede</b> e garantir <b>acesso por perfil (LGPD)</b> ‚Äî do atendimento na ponta at√© a gest√£o, presta√ß√£o de contas e controle social.
              <br />
              <b>Guia SUAS</b> dentro do portal: normas, rotinas e modelos prontos em linguagem simples para orientar equipes e reduzir improviso.
            </p>

            <div className="portal3-cta-row">
              <button
                type="button"
                className="portal3-btn-primary portal3-btn-big"
                onClick={irParaLogin}
              >
                Entrar no sistema
              </button>
              <a className="portal3-link" href="#modulos">
                Conhecer os m√≥dulos ‚Üì
              </a>
              <a className="portal3-link" href="#guia">
                Guia SUAS e atualiza√ß√µes oficiais ‚Üì
              </a>
            </div>

            <div className="portal3-chips">
              <span className="portal3-chip">Perfis e permiss√µes (LGPD)</span>
              <span className="portal3-chip">Rastreabilidade (auditoria)</span>
              <span className="portal3-chip">Fluxo por etapas</span>
              <span className="portal3-chip">Vigil√¢ncia territorial</span>
              <span className="portal3-chip">Rede intermunicipal (cons√≥rcio)</span>
              <span className="portal3-chip">Terceiro setor e parcerias</span>
              <span className="portal3-chip">Conselho e controle social</span>
              <span className="portal3-chip">Guia SUAS (normas e rotinas)</span>
            </div>
          </div>

          <div className="portal3-feature">
            <div className="portal3-feature-title">
              O que isso resolve no SUAS?
            </div>
            <ul className="portal3-bullets">
              <li>Padroniza o atendimento em CRAS, CREAS, Pop Rua e Acolhimentos (evita ‚Äúcada um faz do seu jeito‚Äù).</li>
              <li>Reduz retrabalho e evita perda de informa√ß√£o com hist√≥rico cont√≠nuo do caso/fam√≠lia.</li>
              <li>Organiza a rede: encaminhamentos, devolutivas e responsabilidades por etapa.</li>
              <li>Gera indicadores e evid√™ncias para planejamento, auditoria e presta√ß√£o de contas.</li>
              <li>Protege dados sens√≠veis com LGPD aplicada (m√≠nimo necess√°rio) e trilha de auditoria.</li>
              <li>Ajuda a gest√£o a enxergar gargalos, filas e tempos de atendimento, unidade por unidade.</li>
            </ul>
            <button
              type="button"
              className="portal3-btn-secondary"
              onClick={irParaLogin}
            >
              Ver o painel (login)
            </button>
          </div>
        </div>
      </section>

      <main className="portal3-main">
        <section className="portal3-section" id="modulos">
          <div className="portal3-section-head">
            <h2 className="portal3-h2">
              Um sistema, v√°rios m√≥dulos ‚Äî cada equipe v√™ s√≥ o que precisa.
            </h2>
            <p className="portal3-sub">
              Da recep√ß√£o e triagem ao acompanhamento e monitoramento: o Portal SUAS organiza o fluxo e garante rastreabilidade, sem expor informa√ß√µes indevidas.
            </p>
          </div>

          <div className="portal3-cards-3">
            {modulos.map((m, idx) => (
              <div key={idx} className="portal3-card">
                <div className="portal3-card-icon">{m.icone}</div>
                <div className="portal3-card-title">{m.titulo}</div>
                <div className="portal3-card-text">{m.texto}</div>
              </div>
            ))}
          </div>
        </section>

        <section className="portal3-section" id="licenca">
          <div className="portal3-section-head">
            <h2 className="portal3-h2">
              Por que licenciar um software como este?
            </h2>
            <p className="portal3-sub">
              Porque ele reduz custo invis√≠vel (retrabalho), melhora o atendimento e protege munic√≠pio/cons√≥rcio com governan√ßa de dados, evid√™ncias e LGPD.
            </p>
          </div>

          <div className="portal3-cards-3">
            {motivosLicenca.map((m, idx) => (
              <div key={idx} className="portal3-card">
                <div className="portal3-card-icon">{m.icone}</div>
                <div className="portal3-card-title">{m.titulo}</div>
                <div className="portal3-card-text">{m.texto}</div>
              </div>
            ))}
          </div>

          <div className="portal3-cta-strip">
            <div className="portal3-cta-strip-text">
              Quer conhecer o sistema por dentro? Acesse o painel (login).
            </div>
            <button
              type="button"
              className="portal3-btn-primary"
              onClick={irParaLogin}
            >
              Acessar o painel
            </button>
          </div>
        </section>

        <section className="portal3-section" id="como">
          <div className="portal3-section-head">
            <h2 className="portal3-h2">Como funciona na pr√°tica</h2>
            <p className="portal3-sub">
              O atendimento segue um fluxo simples, com etapas vis√≠veis. Cada etapa tem respons√°veis, prazos e valida√ß√£o, evitando que o caso ‚Äúse perca‚Äù na rede.
            </p>
          </div>

          <div className="portal3-card">
            <ol className="portal3-steps">
              <li><b>Recep√ß√£o e triagem</b> ‚Äî registro inicial e demanda principal.</li>
              <li><b>Pr√©-cadastro / atualiza√ß√£o</b> ‚Äî dados essenciais e encaminhamento correto.</li>
              <li><b>Avalia√ß√£o</b> ‚Äî escuta qualificada e identifica√ß√£o de vulnerabilidades.</li>
              <li><b>Plano (PIA/a√ß√µes)</b> ‚Äî objetivos, estrat√©gias e prazos.</li>
              <li><b>Execu√ß√£o</b> ‚Äî encaminhamentos e acompanhamento.</li>
              <li><b>Monitoramento</b> ‚Äî devolutivas, pend√™ncias e conclus√£o.</li>
            </ol>

            <div className="portal3-note">
              Mensagem-chave: o sistema mostra cada caso como um <b>fluxo por etapas</b>. Se travar, sinaliza e registra motivo (falta de vaga, pend√™ncia de devolutiva, aus√™ncia do usu√°rio, sobrecarga etc.).
            </div>
          </div>
        </section>

        <section className="portal3-section" id="perfis">
          <div className="portal3-section-head">
            <h2 className="portal3-h2">Cada perfil v√™ o que precisa ‚Äî e nada al√©m.</h2>
            <p className="portal3-sub">
              Perfis e permiss√µes com LGPD aplicada na pr√°tica: m√≠nimo necess√°rio, rastreabilidade e auditoria.
            </p>
          </div>

          <div className="portal3-cards-3">
            {perfis.map((p, idx) => (
              <div key={idx} className="portal3-card">
                <div className="portal3-card-icon">{p.icone}</div>
                <div className="portal3-card-title">{p.titulo}</div>
                <div className="portal3-card-text">{p.texto}</div>
              </div>
            ))}
          </div>
        </section>

        <section className="portal3-section" id="guia">
          <div className="portal3-section-head portal3-section-head-row">
            <div>
              <h2 className="portal3-h2">Guia SUAS + Atualiza√ß√µes oficiais (biblioteca do portal)</h2>
              <p className="portal3-sub">
                Refer√™ncias oficiais em linguagem simples: legisla√ß√£o, notas t√©cnicas, orienta√ß√µes, protocolos, modelos prontos e materiais de apoio.
              </p>
            </div>

            <div className="portal3-filter">
              <button
                type="button"
                className={
                  "portal3-pill" +
                  (filtro === "federal" ? " portal3-pill-active" : "")
                }
                onClick={() => setFiltro("federal")}
              >
                Federal
              </button>
              <button
                type="button"
                className={
                  "portal3-pill" +
                  (filtro === "sp" ? " portal3-pill-active" : "")
                }
                onClick={() => setFiltro("sp")}
              >
                Estado SP
              </button>
            </div>
          </div>

          <div className="portal3-cards-3">
            {guiaFiltrado.map((g, idx) => (
              <div key={idx} className="portal3-card">
                <div className="portal3-card-icon">{g.icone}</div>
                <div className="portal3-card-title">{g.titulo}</div>
                <div className="portal3-card-text">{g.texto}</div>
              </div>
            ))}
          </div>

          <div id="atualizacoes" style={{ height: 10 }} />

          <div className="portal3-updates" style={{ marginTop: 12 }}>
            {atualizacoes.map((u, idx) => (
              <a
                key={idx}
                className="portal3-update"
                href={u.url}
                target="_blank"
                rel="noreferrer"
              >
                <div className="portal3-update-top">
                  <span className="portal3-tag">{u.tag}</span>
                  <span className="portal3-date">{u.data}</span>
                </div>
                <div className="portal3-update-title">{u.titulo}</div>
                <div className="portal3-update-text">{u.resumo}</div>
                <div className="portal3-update-link">Abrir documento ‚Üí</div>
              </a>
            ))}

            {atualizacoes.length === 0 && (
              <div className="portal3-empty">
                Nenhuma atualiza√ß√£o encontrada para ‚Äú{busca}‚Äù.
              </div>
            )}
          </div>

          <div className="portal3-cta-strip">
            <div className="portal3-cta-strip-text">
              Quer ver funcionando no seu munic√≠pio? Implanta√ß√£o guiada, treinamento por perfil e suporte cont√≠nuo.
            </div>
            <button
              type="button"
              className="portal3-btn-primary"
              onClick={irParaLogin}
            >
              Acessar o painel
            </button>
          </div>
        </section>

        <footer className="portal3-footer">
          <div className="portal3-footer-inner">
            <span>
              <strong>Portal SUAS</strong> ‚Ä¢ Inteligencia Social
            </span>
            <span className="portal3-footer-muted">
              Conte√∫do do portal em: PreLoginPage.jsx
            </span>
          </div>
        </footer>
      </main>
    </div>
  );
}
