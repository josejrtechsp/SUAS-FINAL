import React, { useMemo, useState } from "react";
import { Link } from "react-router-dom";

import { IDEAL_SERVICES } from "./content/idealServices.js";
import "./Portal.css";

function goAtualizacoes(q) {
  const query = (q || "").trim();
  const url = query ? `/atualizacoes?q=${encodeURIComponent(query)}` : "/atualizacoes";
  window.location.assign(url);
}

export default function PreLoginPage({ onEntrar }) {
  const [busca, setBusca] = useState("");

  const chips = useMemo(
    () => [
      "LGPD por perfil",
      "Trilha de auditoria",
      "Fluxo por etapas",
      "SLA e pend√™ncias",
      "Rede e cons√≥rcio",
      "Dashboards",
      "Pesquisa e diagn√≥stico",
    ],
    []
  );

  const audiencias = useMemo(
    () => [
      {
        icon: "üèõÔ∏è",
        title: "Prefeituras",
        text:
          "Organize execu√ß√£o por fluxo, padronize registros, reduza retrabalho e gere evid√™ncias para auditoria, presta√ß√£o de contas e controle social.",
      },
      {
        icon: "üåê",
        title: "Cons√≥rcios",
        text:
          "Opera√ß√£o regional com padr√µes, indicadores compar√°veis e coopera√ß√£o entre munic√≠pios ‚Äî mantendo LGPD, rastreabilidade e governan√ßa.",
      },
      {
        icon: "üè¢",
        title: "Empresas",
        text:
          "Pesquisa de mercado e intelig√™ncia para decis√£o: posicionamento, satisfa√ß√£o, h√°bitos e oportunidades reais para investir melhor.",
      },
      {
        icon: "üó≥Ô∏è",
        title: "Campanhas",
        text:
          "Pesquisa eleitoral e tracking com leitura territorial e segmenta√ß√£o: menos achismo, mais estrat√©gia e comunica√ß√£o testada.",
      },
    ],
    []
  );

  const modulos = useMemo(
    () => [
      { id: "cras", icon: "üè†", title: "CRAS", text: "Triagem, acompanhamento familiar e encaminhamentos com padr√£o." },
      { id: "creas", icon: "üßæ", title: "CREAS", text: "Casos complexos com etapas, prazos e contexto preservado." },
      { id: "poprua", icon: "üö∂‚Äç‚ôÄÔ∏è", title: "Pop Rua", text: "Abordagem, busca ativa e gest√£o de caso com rastreabilidade." },
      { id: "acolhimentos", icon: "üõèÔ∏è", title: "Acolhimentos", text: "Vagas, entradas/sa√≠das, acompanhamento e relat√≥rios claros." },
      { id: "gestao", icon: "üéØ", title: "Gest√£o", text: "Painel do munic√≠pio: gargalos, produtividade e indicadores." },
      { id: "terceiro_setor", icon: "ü§ù", title: "Terceiro Setor", text: "Parcerias/OSCs: execu√ß√£o, documentos e presta√ß√£o de contas." },
      { id: "vigilancia", icon: "üó∫Ô∏è", title: "Vigil√¢ncia", text: "Indicadores e vis√£o territorial para prioriza√ß√£o e evid√™ncias." },
      { id: "conselho", icon: "üèõÔ∏è", title: "Conselho", text: "CMAS: evid√™ncias e relat√≥rios com trilha de auditoria." },
    ],
    []
  );

  return (
    <div className="portal3-root">
      <header className="portal3-topbar">
        <div className="portal3-topbar-inner">
          <div className="portal3-brandRow">
            <img className="portal3-logo" src="/ideal-logo.png" alt="IDEAL" />
            <div className="portal3-brand">
              <div className="portal3-brand-tag">IDEAL ¬∑ INTELIG√äNCIA P√öBLICA E DE MERCADO</div>
              <div className="portal3-brand-title">
                Plataforma Municipal <span className="portal3-brand-highlight">Integrada</span>
              </div>
              <div className="portal3-brand-sub">GovTech ‚Ä¢ Pesquisa ‚Ä¢ Diagn√≥stico ‚Ä¢ Monitoramento ‚Ä¢ Execu√ß√£o</div>
            </div>
          </div>

          <div className="portal3-actions">
            <input
              className="portal3-search"
              value={busca}
              onChange={(e) => setBusca(e.target.value)}
              onKeyDown={(e) => e.key === "Enter" && goAtualizacoes(busca)}
              placeholder="Buscar no portal (MDS, CNAS, FNAS, Tipifica√ß√£o, NOB SUAS, Cad√önico, RMA...)"
            />
            <button type="button" className="portal3-btn-secondary" onClick={() => goAtualizacoes(busca)}>
              Atualiza√ß√µes oficiais
            </button>
            <button type="button" className="portal3-btn-primary" onClick={() => onEntrar?.()}>
              Acessar o painel
            </button>
          </div>
        </div>
      </header>

      <section className="portal3-hero">
        <div className="portal3-hero-inner">
          <div>
            <div className="portal3-kicker">
              SUAS ‚Ä¢ Sa√∫de ‚Ä¢ Educa√ß√£o ‚Ä¢ Cons√≥rcios ‚Ä¢ Empresas ‚Ä¢ Campanhas ‚Ä¢ Portal de refer√™ncias
            </div>

            <h1 className="portal3-title">
              Do diagn√≥stico √† execu√ß√£o: <span className="portal3-highlight">governan√ßa de dados</span> e software para
              entregar resultado.
            </h1>

            <p className="portal3-lead">
              A IDEAL conecta <b>pesquisa e intelig√™ncia</b>, <b>planejamento e diagn√≥stico</b>, <b>governan√ßa e execu√ß√£o</b>
              e <b>tecnologia</b> ‚Äî com fluxos, SLAs, rastreabilidade e indicadores.
            </p>

            <div className="portal3-cta-row">
              <button type="button" className="portal3-btn-primary portal3-btn-big" onClick={() => onEntrar?.()}>
                Entrar no sistema
              </button>
              <a className="portal3-link" href="#servicos">
                Ver servi√ßos ‚Üì
              </a>
              <a className="portal3-link" href="#modulos">
                Ver m√≥dulos ‚Üì
              </a>
              <a className="portal3-link" href="/atualizacoes">
                Atualiza√ß√µes ‚Üí
              </a>
            </div>

            <div className="portal3-chips">
              {chips.map((c) => (
                <span key={c} className="portal3-chip">
                  {c}
                </span>
              ))}
            </div>
          </div>

          <div className="portal3-feature">
            <div className="portal3-feature-title">O que voc√™ ganha</div>
            <ul className="portal3-bullets">
              <li>Padroniza√ß√£o (fim do ‚Äúcada um faz do seu jeito‚Äù).</li>
              <li>Pend√™ncias, etapas e respons√°veis vis√≠veis (SLA).</li>
              <li>Hist√≥rico cont√≠nuo + trilha de auditoria (evid√™ncias).</li>
              <li>Indicadores para gest√£o, controle social e presta√ß√£o de contas.</li>
              <li>Opera√ß√£o em rede e vis√£o regional (cons√≥rcios).</li>
            </ul>
            <button type="button" className="portal3-btn-secondary" onClick={() => onEntrar?.()}>
              Escolher m√≥dulo (login)
            </button>
          </div>
        </div>
      </section>

      <main className="portal3-main">
        <section className="portal3-section" id="servicos">
          <div className="portal3-section-head">
            <h2 className="portal3-h2">Servi√ßos IDEAL</h2>
            <p className="portal3-sub">
              Clique para abrir uma p√°gina completa do servi√ßo (o que √©, entregas, m√©todo e indicadores).
            </p>
          </div>

          <div className="portal3-cards-4">
            {IDEAL_SERVICES.map((s) => (
              <Link key={s.slug} to={`/servicos/${s.slug}`} className="portal3-card portal3-cardLink">
                <div className="portal3-card-icon" aria-hidden="true">
                  {s.icon}
                </div>
                <div className="portal3-card-title">{s.title}</div>
                <div className="portal3-card-text">{s.excerpt}</div>
                <div className="portal3-cardCta">Ver detalhes ‚Üí</div>
              </Link>
            ))}
          </div>

          <div className="portal3-cta-strip">
            <div className="portal3-cta-strip-text">
              Quer ver ao vivo? Entre no sistema e explore o fluxo, a rastreabilidade e os pain√©is.
            </div>
            <button type="button" className="portal3-btn-primary" onClick={() => onEntrar?.()}>
              Acessar o painel
            </button>
          </div>
        </section>

        <section className="portal3-section" id="modulos">
          <div className="portal3-section-head">
            <h2 className="portal3-h2">M√≥dulos do Sistema (vitrine p√∫blica)</h2>
            <p className="portal3-sub">
              Clique em um m√≥dulo para ver uma p√°gina completa (o que resolve, como ajuda e indicadores).
            </p>
          </div>

          <div className="portal3-cards-4">
            {modulos.map((m) => (
              <Link key={m.id} to={`/modulos/${m.id}`} className="portal3-card portal3-cardLink">
                <div className="portal3-card-icon" aria-hidden="true">
                  {m.icon}
                </div>
                <div className="portal3-card-title">{m.title}</div>
                <div className="portal3-card-text">{m.text}</div>
                <div className="portal3-cardCta">Ver detalhes ‚Üí</div>
              </Link>
            ))}
          </div>

          <div className="portal3-cta-strip">
            <div className="portal3-cta-strip-text">
              Para entrar, voc√™ escolhe o m√≥dulo e acessa com credenciais institucionais.
            </div>
            <button type="button" className="portal3-btn-primary" onClick={() => onEntrar?.()}>
              Escolher m√≥dulo e entrar
            </button>
          </div>
        </section>

        <section className="portal3-section" id="paraquem">
          <div className="portal3-section-head">
            <h2 className="portal3-h2">Caminhos por p√∫blico</h2>
            <p className="portal3-sub">Uma leitura r√°pida para o seu contexto.</p>
          </div>

          <div className="portal3-cards-4">
            {audiencias.map((a) => (
              <div key={a.title} className="portal3-card">
                <div className="portal3-card-icon" aria-hidden="true">
                  {a.icon}
                </div>
                <div className="portal3-card-title">{a.title}</div>
                <div className="portal3-card-text">{a.text}</div>
              </div>
            ))}
          </div>
        </section>

        <footer className="portal3-footer">
          <div className="portal3-footer-inner">
            <span>
              <strong>IDEAL</strong> ‚Ä¢ Intelig√™ncia P√∫blica e de Mercado
            </span>
            <span className="portal3-footer-muted">Portal p√∫blico + entrada do sistema</span>
          </div>
        </footer>
      </main>
    </div>
  );
}
