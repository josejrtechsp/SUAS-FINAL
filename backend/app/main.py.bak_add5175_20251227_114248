# app/main.py
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from .routers import cras_tarefas


from app.core.db import init_db

from app.routers.auth import router as auth_router
from app.routers.municipios import router as municipios_router
from app.routers.pessoas import router as pessoas_router
from app.routers.atendimentos import router as atendimentos_router
from app.routers.casos import router as casos_router
from app.routers.acolhimentos import router as acolhimentos_router
from app.routers.familia_router import router as familia_beneficios_router
from app.routers.encaminhamentos import router as encaminhamentos_router
from app.routers.linha_metro import router as linha_metro_router
from app.routers.saude import router as saude_router
from app.routers.protocolo import router as protocolo_router
from app.routers.dashboard import router as dashboard_router
from app.routers.cras import router as cras_router
from app.routers.cras_casos import router as cras_casos_router
from app.routers.cras_cadastros import router as cras_cadastros_router
from app.routers.cras_programas import router as cras_programas_router
from app.routers.cras_linha_metro import router as cras_linha_metro_router
from app.routers.cras_cadunico import router as cras_cadunico_router
from app.routers.cras_pia import router as cras_pia_router
from app.routers.cras_scfv import router as cras_scfv_router
from app.routers.cras_ficha import router as cras_ficha_router
from app.routers.cras_relatorios import router as cras_relatorios_router





app = FastAPI(title="Sistema Pop Rua")

# ✅ Ajuste conforme seu front (Vite 5173/5174 etc.)
ORIGINS = [
    "http://localhost:5173",
    "http://127.0.0.1:5173",
    "http://localhost:5174",
    "http://127.0.0.1:5174",
    "http://localhost:3000",
    "http://127.0.0.1:3000",
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)


@app.on_event("startup")
def on_startup():
    init_db()


@app.get("/health")
def health_check():
    return {"status": "ok"}


# ✅ Routers
app.include_router(auth_router)
app.include_router(cras_tarefas.router)
app.include_router(municipios_router)
app.include_router(pessoas_router)
app.include_router(atendimentos_router)
app.include_router(casos_router)
app.include_router(acolhimentos_router)
app.include_router(familia_beneficios_router)
app.include_router(encaminhamentos_router)
app.include_router(linha_metro_router)
app.include_router(saude_router)
app.include_router(protocolo_router)
app.include_router(dashboard_router)
app.include_router(cras_router)
app.include_router(cras_casos_router)
app.include_router(cras_cadastros_router)
app.include_router(cras_programas_router)
app.include_router(cras_linha_metro_router)
app.include_router(cras_cadunico_router)


app.include_router(cras_pia_router)

app.include_router(cras_scfv_router)

app.include_router(cras_ficha_router)

app.include_router(cras_relatorios_router)
